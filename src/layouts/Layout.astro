---
import "../styles/global.css";
import '@fontsource-variable/onest';
import '@fontsource/poppins/800.css';
import '@fontsource/poppins/700.css';
import '@fontsource/poppins/600.css';
import '@fontsource/poppins/500.css';
import Header from "../components/Header.astro";
import Home from "../components/Home.astro";
import Experience from "../components/Experience.astro";
import Projects from "../components/Projects.astro";
import Footer from "../components/Footer.astro";
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="stylesheet" type='text/css' href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
		<meta name="generator" content={Astro.generator} />
		<title>Portafolio de Diego Gonz√°lez</title>
		<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
        <script is:inline>
            (function() {
                document.documentElement.style.backgroundColor = '#121212';
                
                const isDarkMode = localStorage.getItem('theme') === 'dark' || 
                    (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
                
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                    document.documentElement.style.backgroundColor = '#121212';
                } else {
                    document.documentElement.classList.remove('dark');
                    document.documentElement.style.backgroundColor = '#FAFAFA';
                }
                
                window.addEventListener('load', () => {
                    document.documentElement.style.backgroundColor = '';
                });
            })();
        </script>
	</head>
	<body>
		<Header />
		<Home />
		<Experience />
		<Projects />
		<Footer />
		<slot />
	</body>
</html>

<style is:global>

	html {
		font-family: 'Onest Variable', 'Poppins' ,system-ui, sans-serif;
		color: var(--color-text);
		background: var(--color-background);
        transition: background-color 0.3s ease;
	}

	body {
		display: flex;
		flex-direction: column;
		justify-content: center;
	}

	 .animate-fade-in:not(.visible),
    .animate-slide-up:not(.visible),
    .animate-slide-in:not(.visible),
    .animate-pop-in:not(.visible),
    .animate-scale-in:not(.visible),
    .animate-icon:not(.visible) {
        opacity: 0;
        pointer-events: none;
    }

    .animate-fade-in:not(.visible) {
        transform: translateY(20px);
    }

    .animate-slide-up:not(.visible) {
        transform: translateY(20px);
    }

    .animate-slide-in:not(.visible) {
        transform: translateX(-20px);
    }

    .animate-pop-in:not(.visible) {
        transform: scale(0.9);
    }

    .animate-scale-in:not(.visible) {
        transform: scale(0.95);
    }

    .animate-icon:not(.visible) {
        transform: translateY(20px);
    }

    .animate-fade-in.visible,
    .animate-slide-up.visible,
    .animate-slide-in.visible,
    .animate-pop-in.visible,
    .animate-scale-in.visible,
    .animate-icon.visible {
        opacity: 1;
        pointer-events: auto;
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }

    .animate-fade-in.visible,
    .animate-slide-up.visible,
    .animate-icon.visible {
        transform: translateY(0);
    }

    .animate-slide-in.visible {
        transform: translateX(0);
    }

    .animate-pop-in.visible {
        transform: scale(1);
        transition: opacity 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .animate-scale-in.visible {
        transform: scale(1);
    }
</style>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        
        const homeElements = document.querySelectorAll('#inicio .animate-fade-in, #inicio .animate-slide-up, #inicio .animate-icon');
        homeElements.forEach(el => {
            el.classList.add('visible');
        });
        
        const observerOptions = {
            root: null,
            rootMargin: '-50px 0px', 
            threshold: 0.1 
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    if (!entry.target.classList.contains('visible')) {
                        const delayIndex = parseInt(entry.target.dataset.animationIndex || '0');
                        setTimeout(() => {
                            entry.target.classList.add('visible');
                        }, delayIndex * 100); 
                    }
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);
        
        const experienceSection = document.getElementById('experiencia');
        if (experienceSection) {
            
            const titleElement = experienceSection.querySelector('.text-4xl');
            if (titleElement) {
                if (!titleElement.classList.contains('animate-fade-in')) {
                    titleElement.classList.add('animate-fade-in');
                }
                titleElement.setAttribute('data-animation-index', '0');
                observer.observe(titleElement);
            }
            
            const jobElements = experienceSection.querySelectorAll('.p-5');
            jobElements.forEach((el, index) => {
                if (!el.classList.contains('animate-slide-in')) {
                    el.classList.add('animate-slide-in');
                }
                el.setAttribute('data-animation-index', (index + 1).toString());
                observer.observe(el);
            });
        }
        
        const projectsSection = document.getElementById('proyectos');
        if (projectsSection) {
            
            const titleElement = projectsSection.querySelector('.text-4xl');
            if (titleElement) {
                if (!titleElement.classList.contains('animate-fade-in')) {
                    titleElement.classList.add('animate-fade-in');
                }
                titleElement.setAttribute('data-animation-index', '0');
                observer.observe(titleElement);
            }
            
            const categoryButtons = projectsSection.querySelectorAll('.category-btn');
            categoryButtons.forEach((el, index) => {
                if (!el.classList.contains('animate-pop-in')) {
                    el.classList.add('animate-pop-in');
                }
                el.setAttribute('data-animation-index', (index + 1).toString());
                observer.observe(el);
            });
            
            const projectCards = projectsSection.querySelectorAll('.project-card');
            projectCards.forEach((el, index) => {
                if (!el.classList.contains('animate-scale-in')) {
                    el.classList.add('animate-scale-in');
                }
                el.setAttribute('data-animation-index', (index + 5).toString());
            });
        }
        
        setTimeout(() => {
            const categoryButtons = document.querySelectorAll('.category-btn');
            
            categoryButtons.forEach(button => {
                const originalClickHandler = button.onclick;
                
                button.onclick = function(e) {
                    
                    if (originalClickHandler) {
                        originalClickHandler.call(this, e);
                    }
                    
                    const selectedCategory = this.dataset.categoria;
                    
                    const container = document.querySelector(`.categoria-container[data-categoria="${selectedCategory}"]`);
                    if (container) {
                        const visibleCards = container.querySelectorAll('.project-card');
                        
                        visibleCards.forEach((card) => {
                            if (!card.classList.contains('visible')) {
                                observer.observe(card);
                            }
                        });
                    }
                };
            });
            
            const firstCategoryButton = document.querySelector('.category-btn');
            if (firstCategoryButton) {
                firstCategoryButton.click();
            }
        }, 500);
    });
</script>

<script>
    import { translations } from "../data/translations.js";
    
    function translatePage(lang: string) {
        const elements = document.querySelectorAll("[data-i18n]");
        
        elements.forEach((element) => {
            const key = element.getAttribute("data-i18n");
            if (!key) return;
            
            const keys = key.split(".");
            let translation: any = translations[lang as keyof typeof translations];
            
            for (const k of keys) {
                translation = translation?.[k];
            }
            
            if (translation && typeof translation === "string") {
                element.textContent = translation;
            }
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
        const currentLang = localStorage.getItem("language") || "es";
        translatePage(currentLang);
    });

    window.addEventListener("languageChanged", ((e: CustomEvent) => {
        translatePage(e.detail.language);
    }) as EventListener);
</script>